<div class="grid_15 prefix_1" id="language-content">
<a name="language_top"/>
<h1>Redirection</h1>
<ul>
<li><a href="#language_syntax">Syntax</a></li>
<li><a href="#language_example1">Example 1 - Calculator</a></li>
<li><a href="#language_dynamic">Dynamic binding</a></li>
<li><a href="#language_example2">Example 2 - Calculator dynamic binding</a></li>
<li><a href="#language_dynamic_redirection">Dynamic Redirection</a></li>
<li><a href="#language_example3">Example 3 - Calculator dynamic redirection</a></li>
</ul>
<br><br>
Redirection allows for the creation of a master service acting as a single
communication endpoint to multiple services, called resources. The master
service receives all the messages meant for the system that it handles. This
is obtained by binding an input port of the master service to multiple output
ports, each one identifying a service by means of a resource name. Invokers
send messages to the master service specifying also the intended resource
name. The main advantages of such an approach are:<br>
<br>
<ul>
<li>the possibility to provide a unique access point to the system clients. In
this way the services of the system could be relocated and/or replaced
transparently w.r.t. the clients;</li>
<li>the possibility to provide transparent communication protocol transformations 
between the invoker and the master and the master and the
rest of the system.</li>
</ul>
<br>
<div id="figure">
  <img src="./images/redirecting.jpg">
  <div id="caption"><b>Figure Redirection.1:</b> Service <i>M</i> redirects messages to services <i>A</i>, 
<i>B</i> and <i>C</i> depending
on the target destination of the message (<i>M/A</i>, <i>M/B</i> or <i>M/C</i>).
</div>
</div>
In order to understand the second advantage better, consider <b>Fig. Redirection.1</b> and
suppose that <i>A</i> speaks a certain protocol <i>pa</i> . Now suppose that a client needs
to interact with <i>A</i>, but it does know only a diﬀerent protocol: <i>pm</i> . The client
could then call <i>M</i> with destination <i>M/A</i> using protocol <i>pm</i> (known by <i>M</i> ),
and leave to <i>M</i> the task of transforming the call message into an instance of
pa before sending it to <i>A</i>.<br>
<a name="language_syntax"/>
<h2>Syntax</h2>
&gt; <a href="#language_top">Go on top</a><br><br>
The syntax for setting up a master service follows:
<div id="syntax" src="syntax_redirection"/>
where <i>outputPortId</i> ranges over output port identiﬁers and the form <i>id</i> =>
<i>outputPortId</i> associates a resource name to an output port.
Calling a master service for one of its resources is done by introducing the
resource name in the location used by the invoker, followed by the resource
name separator !/:
<div id="syntax" src="syntax_redirection_2"/>

<a name="language_example1"/>
<h2>Example 1 - Calculator</h2>
&gt; <a href="#language_top">Go on top</a>
<div id="download">&gt; <a href="./content/code/code_redirection_1.zip">Download code</a></div>
In this example we create two services which provide different functionalities:
one calculates the sum of two input numbers whereas the other calculates the subtraction. 
In the following we report the code of that which calculate the sum:
<div id="example" src="example_redirection_1"/>
Now we create a unique endpoint access to which redirects the incoming requests to the right service.
<div id="example" src="example_redirection_2"/>
The inputPort MyService contains the keyword Redirects which associates the resource Sub to the outputPort 
SubService and the resource Sum to the outputPort SumService. The unique endpoint is located at <i>socket://localhost:8000/</i>.
Now, let us consider a client which can invoke both services for performing a sum or a subtraction:
<div id="example" src="example_redirection_3"/>

<a name="language_dynamic"/>
<h2>Dynamic binding</h2>
&gt; <a href="#language_top">Go on top</a><br><br>
Redirected outputPorts can be bound dynamically at runtime by changing the location of the 
outputPort. Such an action can be achieved by exploiting the javaService <a href="#language_runtime"><i>Runtime</i></a>
which offers the operation <i>setOutputPort</i>. 
It is worth noting that it is not possible to
rebind a redirected outputPort by simply changing its location with a common assignment such as the following one:
<div id="example" src="example_redirection_4"/>
In this case, indeed, the new assignment visibility will be limited to the session variable scope
and it will not be exploited by the redirection. On the contrary the usage of the Runtimne service
will allow for the performing of a permanent rebinding which will be visible to all the service.

<a name="language_example2"/>
<h2>Example 2 - Calculator dynamic binding</h2>
&gt; <a href="#language_top">Go on top</a>
<div id="download">&gt; <a href="./content/code/code_redirection_2.zip">Download code</a></div>
In the following we present the code of the redirector where it is possible to rebind the 
redirection by exploiting some simple line commands.
<div id="example" src="example_redirection_5"/>

<a name="language_dynamic_redirection"/>
<h2>Dynamic Redirection</h2>
&gt; <a href="#language_top">Go on top</a><br><br>
Redirection can be set dynamically by exploiting the javaService <a href="#language_runtime"><i>Runtime</i></a>
which offers the operations <i>setRedirection</i> and <i>removeRedirection</i>. 
The former operation allows for the setting of a new redirection for a given inputPort,
whereas the latter allows for the deleting of an existing redirection.

<a name="language_example3"/>
<h2>Example 3 - Calculator dynamic redirection</h2>
&gt; <a href="#language_top">Go on top</a>
<div id="download">&gt; <a href="./content/code/code_redirection_3.zip">Download code</a></div>
In the following we have modified the interfaces of both the SumService and the SubService 
in a way they offer the same operation called <i>operator</i>. In this case the difference
the client can decide to perform a sum or a subtraction only by changing the resource name
as it follows:
<div id="example" src="example_redirection_6"/>
As far as the redirector is concerned we would like to program it in order to 
impement a little joke for the client. When the user insert the command <i>change</i>
all the sums will be redirected to the subtraction service and viceversa. Every
time the command <i>change</i> is inserted the switch between the two services is performed.
<div id="example" src="example_redirection_7"/>

