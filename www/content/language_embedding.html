<div class="grid_15 prefix_1" id="language-content">
<a name="language_top"/>
<h1>Embedding</h1>
<ul>
<li><a href="#language_embedding_jolie_service">Embedding a Jolie service</a></li>
<li><a href="#language_embedding_embedded">embedded{}</a></li>
</ul>
<br><br>
Embedding is a powerful mechanism that allows you to run multiple services in the same Java Virtual Machine (JVM). 
We distinguish between the <i>embedder</i> and the <i>embedded</i> services where the former is the service which embeds the latter one.
The embedder and the embedded services can communicate each other by means of usual input and output ports,
thus allowing the programmer to define topology independently from the connections (see <a href="#language">Introduction</a>).
In the following figure we show how we represent the topology of a system with one embedder and one embedded. 
<div id="figure">
  <img src="./images/embedding_topology.jpeg">
  <div id="caption"><b>Figure Embedding.1</b>: We express embedding by means of a row with a circle edge
in correspondance of the <i>embedder</i> and the line edge in correspondance with the <i>embedded</i>.
</div>
</div>
It is worth noting that we can design the connections independently from that topology as we show in the following
figure where the parent and the child can freely exchange messages each others.
<div id="figure">
  <img src="./images/embedding_connections.jpeg">
  <div id="caption"><b>Figure Embedding.2</b>: In this example both the embedder and the embedded have
an output port connected with the input port of the other service.
</div>
</div>

<a name="language_embedding_jolie_service"/>
<h2>Embedding a Jolie service</h2>
&gt; <a href="#language_top">Go on top</a><br><br>
Let us now build a service specifically designed to be embedded. We name it embedded.ol:
<div id="example" src="example_embedding_1"/>
The service exhibits a RequestResponse operation called <i>start</i> and the location where the service is deployed is set to <i>"local</i>. 
Location <i>"local"</i> programs the Jolie interpreter to make that inputPort available only in the local JVM scope.
Now, let us build the embedder:
<div id="example" src="example_embedding_2"/><br>
<div id="download">&gt; <a href="./content/code/code_embedding_1.zip">Download code</a></div>
The embedder calls the embedded service on its operation <i>start</i> by sending the message "Message from the embedder",
as a response it will receive the answer "Hi". 


<a name="language_embedding_embedded"/>
<h2>embedded{}</h2>
&gt; <a href="#language_top">Go on top</a><br><br>
Embedding is achieved by using the primitive <i>embedded{}</i>
where it is possible to define the service resource to be embedded. At the present it is
possible to embed three different resource types:
<ul>
  <li>Jolie</li>
  <li>Java (see <a href="#language_javaservices">Javaservices</a>)</li>
  <li>Javascript (see <a href="#language_javaservices">Javaservices</a>)</li>
</ul>
The syntax of embedded primitive and an example of its usage follow:
<div id="syntax" src="syntax_embedding_1"/>
An example follows:
<div id="example" src="example_embedding_3"/><br>
A <i>Resource</i> is a path which specifies where the interpreter can find 
the service to embed. When embedding a Jolie service, the service path must be the 
filename of the source file of the Jolie program to execute. 
The path can be absolute or relative.<br><br>

Embedded services can be joined to an outputPort in order to communicate 
with them by means of a fast, in-memory communication mechanism. In the example 
above we joined the embedded service to outputPorts <i>MyEmbeddedService</i>,
<i>MyEmbeddedService2</i> and <i>MyEmbeddedJavaClass</i>.
</div>